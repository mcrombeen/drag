<!DOCTYPE html>
<html>
  <head>
    <style>
      .canvas {
        width: 100%;
        height: 100%;
        background-color: #ddd;
        position: absolute;
      }

      .images {
        width: 100px;
        height: 100px;
        position: absolute;
      }
    </style>
  </head>
  <body>
    <div class="canvas">
      <img class="images" src="https://raw.githubusercontent.com/mcrombeen/css/main/hounted_house.png">
      <img class="images" src="https://raw.githubusercontent.com/mcrombeen/css/main/hounted_house.png">
      <img class="images" src="https://raw.githubusercontent.com/mcrombeen/css/main/hounted_house.png">
    </div>

    <script>
      const images = document.querySelectorAll(".images");

      let zIndexCounter = 1;
      let activeImage = null;
      let initialX;
      let initialY;
      const offsets = new Map();

      function getRandomPosition() {
        const canvasWidth = window.innerWidth;
        const canvasHeight = window.innerHeight;
        const x = Math.random() * (canvasWidth - 100);
        const y = Math.random() * (canvasHeight - 100);
        return { x, y };
      }

      function savePositions() {
        const positions = [];
        images.forEach((image, index) => {
          const { xOffset, yOffset } = offsets.get(image);
          positions.push({ xOffset, yOffset });
        });
        localStorage.setItem("imagePositions", JSON.stringify(positions));
      }

      function loadPositions() {
        const positions = JSON.parse(localStorage.getItem("imagePositions"));
        if (!positions) return;

        images.forEach((image, index) => {
          const { xOffset, yOffset } = positions[index];
          offsets.set(image, { xOffset, yOffset });
          setTranslate(xOffset, yOffset, image);
        });
      }

      images.forEach((image, index) => {
        let isDragging = false;
        const { x, y } = getRandomPosition();
        offsets.set(image, { xOffset: x, yOffset: y });
        setTranslate(x, y, image);

        image.addEventListener("mousedown", dragStart);

        function dragStart(e) {
          if (isDragging) return;

          const { xOffset, yOffset } = offsets.get(image);
          initialX = e.clientX - xOffset;
          initialY = e.clientY - yOffset;

          isDragging = true;
          activeImage = image;
        }
      });

      window.addEventListener("mouseup", dragEnd);
      window.addEventListener("mousemove", drag);

      function dragEnd(e) {
        if (!activeImage) return;
        savePositions();
        activeImage = null;
      }

      function drag(e) {
        if (!activeImage) return;
        e.preventDefault();

        const { xOffset, yOffset } = offsets.get(activeImage);
        const currentX = e.clientX - initialX;
        const currentY = e.clientY - initialY;

        offsets.set(activeImage, { xOffset: currentX, yOffset: currentY });

        setTranslate(currentX, currentY, activeImage);
      }

      function setTranslate(xPos, yPos, el) {
        el.style.transform = "translate3d(" + xPos + "px, " + yPos + "px, 0)";
      }

      images.forEach((image) => {
        image.addEventListener("mousedown", () => {
        image.style.zIndex = zIndexCounter++;
        });
      });

      
      //uncomment to load stored positions
     // loadPositions();
      
    </script>
  </body>
</html>

